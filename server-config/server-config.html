<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Server config &mdash; Near-line Data Store 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="The System Status Monitor" href="../system-status.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/ceda.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../home.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../specification.html">Specification document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system-status.html">Using the system status page</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The server config file</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#required-sections">Required sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authentication">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rabbitmq">RabbitMQ</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generic-optional-sections">Generic optional sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#logging">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general">General</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#consumer-specific-optional-sections">Consumer-specific optional sections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nlds-worker">NLDS Worker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#indexer">Indexer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cataloguer">Cataloguer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transfer-put-and-transfer-get">Transfer-put and Transfer-get</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monitor">Monitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logger">Logger</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Server config examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/cta-emulator.html">Setting up a CTA tape emulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/alembic-migrations.html">Database Migrations with Alembic</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/nlds-processors.html">NLDS Processors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-reference/nlds-server.html">NLDS Server</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Near-line Data Store</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Server config</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/server-config/server-config.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="server-config">
<h1>Server config<a class="headerlink" href="#server-config" title="Permalink to this headline"></a></h1>
<p>The server config file controls the configurable behaviour of the NLDS. It is a
json file split into dictionary sections, with each section delineating
configuration for a specific part of the program. There is an example
server_config in the templates section of the main nlds package
(<code class="docutils literal notranslate"><span class="pre">nlds.templates.server_config</span></code>) to get you started, but this page will
demystify the configuration needed for (a) a local development copy of the nlds,
and (b) a production system spread across several pods/virtual machines.</p>
<p><em>Please note that the NLDS is in active development and all of this is subject
to change with no notice.</em></p>
<div class="section" id="required-sections">
<h2>Required sections<a class="headerlink" href="#required-sections" title="Permalink to this headline"></a></h2>
<p>There are two required sections for every server_config: <code class="docutils literal notranslate"><span class="pre">authentication</span></code> and
<code class="docutils literal notranslate"><span class="pre">rabbitMQ</span></code>.</p>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline"></a></h3>
<p>This deals with how users are authenticated through the OAuth2 flow used in the
client. The following fields are required in the dictionary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;authentication&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;authenticator_backend&quot;</span> <span class="p">:</span> <span class="s2">&quot;jasmin_authenticator&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jasmin_authenticator&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;user_profile_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ user_profile_url }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;user_services_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ user_services_url }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oauth_token_introspect_url&quot;</span> <span class="p">:</span> <span class="s2">&quot;{{ token_introspect_url }}&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">authenticator_backend</span></code> dictates which form of authentication you would
like to use. Currently the only implemented authenticator is the
<code class="docutils literal notranslate"><span class="pre">jasmin_authenticator</span></code>, but there are plans to expand this to also work with
other industry standard authenticators like google and microsoft.</p>
<p>The authenticator setup is then specified in a separate dictionary named after
the authenticator, which is specific to each authenticator. The
<code class="docutils literal notranslate"><span class="pre">jasmin_authenticator</span></code> requires, as above, values for <code class="docutils literal notranslate"><span class="pre">user_profile_url</span></code>,
<code class="docutils literal notranslate"><span class="pre">user_services_url</span></code>, and <code class="docutils literal notranslate"><span class="pre">oauth_token_introspect_url</span></code>. This cannot be
divulged publicly on github for JASMIN, so please get in contact for the actual
values to use.</p>
</div>
<div class="section" id="rabbitmq">
<h3>RabbitMQ<a class="headerlink" href="#rabbitmq" title="Permalink to this headline"></a></h3>
<p>This deals with how the nlds connects to the RabbitMQ queue and message
brokering system. The following is an outline of what is required:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;rabbitMQ&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_user }}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_password }}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_server }}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;vhost&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_vhost }}&quot;</span><span class="p">,</span>
    <span class="s2">&quot;exchange&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_exchange_name }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_exchange_type }}&quot;</span><span class="p">,</span>
        <span class="s2">&quot;delayed&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_exchange_delayed }}&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;queues&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_queue_name }}&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bindings&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;exchange&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_exchange_name }}&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;routing_key&quot;</span><span class="p">:</span> <span class="s2">&quot;{{ rabbit_queue_routing_key }}&quot;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> fields refer to the username and password for
the rabbit server you wish to connect to, which is in turn specified with
<code class="docutils literal notranslate"><span class="pre">server</span></code>. <code class="docutils literal notranslate"><span class="pre">vhost</span></code> is similarly the virtual host on the rabbit server that
you wish to connect to.</p>
<p>The next two dictionaries are context specific. All publishing elements of the
NLDS, i.e. parts that will send messages, will require an exchange to publish
messages to. <code class="docutils literal notranslate"><span class="pre">exchange</span></code> is determines that exchange, with three required
subfields: <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code>, and <code class="docutils literal notranslate"><span class="pre">delayed</span></code>. The former two are self
descriptive, they should just be the name of the exchange on the virtualhost and
it’s corresponding type e.g. one of fanout, direct or topic. <code class="docutils literal notranslate"><span class="pre">delay</span></code> is a
boolean (<code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code> in json-speak) dictating whether to use the
delay functionality utilised within the NLDS. Note that this requires the rabbit
server have the DelayedRabbitExchange plugin installed.</p>
<p>Exchanges can be declared and created if not present on the virtual host the
first time the NLDS is run, virtualhosts cannot and so will have to be created
beforehand manually on the server or through the admin interface. If an exchange
is requested but incorrect information given about either its <cite>type</cite> or
<cite>delayed</cite> status, then the NLDS will throw an error.</p>
<p><code class="docutils literal notranslate"><span class="pre">queues</span></code> is a list of queue dictionaries and must be implemented on consumers,
i.e. message processors, to tell <code class="docutils literal notranslate"><span class="pre">pika</span></code> where to take messages from. Each
queue dictionary consists of a <code class="docutils literal notranslate"><span class="pre">name</span></code> and a list of <cite>bindings</cite>, with each
<code class="docutils literal notranslate"><span class="pre">binding</span></code> being a dictionary containing the name of the <code class="docutils literal notranslate"><span class="pre">exchange</span></code> the queue
takes messages from, and the routing key that a message must have to be accepted
onto the queue. For more information on exchanges, routing keys, and other
RabbitMQ features, please see [Rabbit’s excellent documentation]
(<a class="reference external" href="https://www.rabbitmq.com/tutorials/tutorial-five-python.html">https://www.rabbitmq.com/tutorials/tutorial-five-python.html</a>).</p>
</div>
</div>
<div class="section" id="generic-optional-sections">
<h2>Generic optional sections<a class="headerlink" href="#generic-optional-sections" title="Permalink to this headline"></a></h2>
<p>There are 2 generic sections, i.e. those which are used across the NLDS
ecosystem, but are optional and therefore fall back on a default configuration
if not specified. These are <code class="docutils literal notranslate"><span class="pre">logging</span></code>, and <code class="docutils literal notranslate"><span class="pre">general</span></code>.</p>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline"></a></h3>
<p>The logging configuration options look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;enable&quot;</span><span class="p">:</span> <span class="n">boolean</span>
    <span class="s2">&quot;log_level&quot;</span><span class="p">:</span> <span class="nb">str</span>  <span class="o">-</span> <span class="p">(</span><span class="s2">&quot;none&quot;</span> <span class="o">|</span> <span class="s2">&quot;debug&quot;</span> <span class="o">|</span> <span class="s2">&quot;info&quot;</span> <span class="o">|</span> <span class="s2">&quot;warning&quot;</span> <span class="o">|</span> <span class="s2">&quot;error&quot;</span> <span class="o">|</span> <span class="s2">&quot;critical&quot;</span><span class="p">),</span>
    <span class="s2">&quot;log_format&quot;</span><span class="p">:</span> <span class="nb">str</span> <span class="o">-</span> <span class="n">see</span> <span class="n">python</span> <span class="n">logging</span> <span class="n">docs</span> <span class="k">for</span> <span class="n">details</span><span class="p">,</span>
    <span class="s2">&quot;add_stdout_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;stdout_log_level&quot;</span><span class="p">:</span> <span class="nb">str</span>  <span class="o">-</span> <span class="p">(</span><span class="s2">&quot;none&quot;</span> <span class="o">|</span> <span class="s2">&quot;debug&quot;</span> <span class="o">|</span> <span class="s2">&quot;info&quot;</span> <span class="o">|</span> <span class="s2">&quot;warning&quot;</span> <span class="o">|</span> <span class="s2">&quot;error&quot;</span> <span class="o">|</span> <span class="s2">&quot;critical&quot;</span><span class="p">),</span>
    <span class="s2">&quot;log_files&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="s2">&quot;rollover&quot;</span><span class="p">:</span> <span class="nb">str</span> <span class="o">-</span> <span class="n">see</span> <span class="n">python</span> <span class="n">logging</span> <span class="n">docs</span> <span class="k">for</span> <span class="n">details</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These all set default options the native python logging system, with
<code class="docutils literal notranslate"><span class="pre">log_level</span></code> being the log level, <code class="docutils literal notranslate"><span class="pre">log_format</span></code> being a string describing the
log output format, and rollover describing the frequency of rollover for log
files in the standard manner. For details on all of this, see the python docs
for inbuilt logging. <code class="docutils literal notranslate"><span class="pre">enable</span></code> and <code class="docutils literal notranslate"><span class="pre">add_stdout_fl</span></code> are boolean flags
controlling log output to files and <code class="docutils literal notranslate"><span class="pre">stdout</span></code> respectively, and the
<code class="docutils literal notranslate"><span class="pre">stdout_log_level</span></code> is the log level for the stdout logging, if you require it
to be different from the default log level.</p>
<p><code class="docutils literal notranslate"><span class="pre">log_files</span></code> is a list of strings describing the path or paths to log files
being written to. If no log files paths are given then no file logging will be
done. If active, the file logging will be done with a TimedRotatingFileHandler,
i.e. the files will be rotated on a rolling basis, with the rollover time
denoted by the <code class="docutils literal notranslate"><span class="pre">rollover</span></code> option, which is a time string similar to that found
in crontab. Please see the [python logging docs]
(<a class="reference external" href="https://docs.python.org/3/library/logging.handlers.html#logging.handlers.TimedRotatingFileHandler">https://docs.python.org/3/library/logging.handlers.html#logging.handlers.TimedRotatingFileHandler</a>)
for more info on this.</p>
<p>As stated, these all set the default log options for all publishers and
consumers within the NLDS - these can be overridden on a consumer-specific basis
by inserting a <code class="docutils literal notranslate"><span class="pre">logging</span></code> sub-dictionary into a consumer-specific optional
section.</p>
</div>
<div class="section" id="general">
<h3>General<a class="headerlink" href="#general" title="Permalink to this headline"></a></h3>
<p>The general config, as of writing this page, only covers one option: the
retry_delays list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;general&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;retry_delays&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This retry delays list gives the delay applied to retried messages in seconds,
with the <a href="#id1"><span class="problematic" id="id2">`</span></a>n`th element being the delay for the <a href="#id3"><span class="problematic" id="id4">`</span></a>n`th retry. Setting the value
here sets a default for _all_ consumers, but the retry_delays option can be
inserted into any consumer-specific config section to override this.</p>
</div>
</div>
<div class="section" id="consumer-specific-optional-sections">
<h2>Consumer-specific optional sections<a class="headerlink" href="#consumer-specific-optional-sections" title="Permalink to this headline"></a></h2>
<p>Each of the consumers have their own configuration dictionary, named by
convention as <code class="docutils literal notranslate"><span class="pre">{consumername}_q</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">transfer_put_q</span></code>. Each has a set of
default options and will accept both a logging dictionary and a retry_delays
list for consumer-specific override of the default options, mentioned above.
Each consumer also has a specific set of config options, some shared, which will
control its behaviour. The following is a brief rundown of the server config
options for each consumer.</p>
<div class="section" id="nlds-worker">
<h3>NLDS Worker<a class="headerlink" href="#nlds-worker" title="Permalink to this headline"></a></h3>
<p>The server config section is <code class="docutils literal notranslate"><span class="pre">nlds_q</span></code>, and the following options are available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;nlds_q&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">standard_logging_dictionary</span><span class="p">],</span>
    <span class="s2">&quot;retry_delays&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="s2">&quot;print_tracebacks_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Not much specifically happens in the NLDS worker that requires configuration, so
it basically just has the default settings. One that has not been covered yet,
<code class="docutils literal notranslate"><span class="pre">print_tracebacks_fl</span></code>, is a boolean flag to control whether the full
stacktrace of any caught exception is sent to the logger. This is a standard
across all consumers. You may set retry_delays if you wish but the NLDS worker
doesn’t retry messages specifically, only in the case of something going
unexpectedly wrong.</p>
</div>
<div class="section" id="indexer">
<h3>Indexer<a class="headerlink" href="#indexer" title="Permalink to this headline"></a></h3>
<p>Server config section is <code class="docutils literal notranslate"><span class="pre">index_q</span></code>, and the following options are available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;index_q&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">standard_logging_dictionary</span><span class="p">},</span>
    <span class="s2">&quot;retry_delays&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="s2">&quot;print_tracebacks_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;filelist_max_length&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s2">&quot;message_threshold&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s2">&quot;check_permissions_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;check_filesize_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;use_pwd_gid_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">logging</span></code>, <code class="docutils literal notranslate"><span class="pre">retry_delays</span></code>, and <code class="docutils literal notranslate"><span class="pre">print_tracebacks_fl</span></code> are, as above,
standard configurables within the NLDS consumer ecosystem.
<code class="docutils literal notranslate"><span class="pre">filelist_maxlength</span></code> determines the maximum length that any file-list provided
to the indexer consumer during the <cite>init</cite> (i.e. <cite>split</cite>) step can be. Any
transaction that is given initially with a list that is longer than this value
will be split down into many sub-transactions with this as a maximum length. For
example, with the default value of 1000, and a transaction with an initial list
size of 2500, will be split into 3 sub-transactions; 2 of them having a
list of 1000 files and the remaining 500 files being put into the third
sub-transaction.</p>
<p><code class="docutils literal notranslate"><span class="pre">message</span> <span class="pre">threshold</span></code> is very similar in that it places a limit on the total
size of files within a given filelist. It is applied at the indexing
(<cite>nlds.index</cite>) step when files have actually been statted, and so will further
sub-divide any sub-transactions at that point if they are too large or are
revealed to contain lots of folders with files in upon indexing. <code class="docutils literal notranslate"><span class="pre">max_retries</span></code>
control the maximum number of times an entry in a filelist can be attempted to
be indexed, either because it doesn’t exist or the user doesn’t have the
appropriate permissions to access it at time of indexing. This feeds into retry
delays, as each subsequent time a sub-transaction is retried it will be delayed
by the amount specified at that index within the <code class="docutils literal notranslate"><span class="pre">retry_delays</span></code> list. If
<code class="docutils literal notranslate"><span class="pre">max_retries</span></code> exceeds <code class="docutils literal notranslate"><span class="pre">len(retry_delays)</span></code>, then any retries which don’t have
an explicit retry delay to use will use the final element in the <code class="docutils literal notranslate"><span class="pre">retry_delays</span></code>
list.</p>
<p><code class="docutils literal notranslate"><span class="pre">check_permissions_fl</span></code> and <code class="docutils literal notranslate"><span class="pre">check_filesize_fl</span></code> are commonly used boolean
flags to control whether the indexer checks the permissions and filesize of
files respectively during the indexing step.</p>
<p><code class="docutils literal notranslate"><span class="pre">use_pwd_gid_fl</span></code> is a final boolean flag which controls how permissions
checking goes about getting the gid to check group permissions against. If True,
it will _just_ use the gid found in the <code class="docutils literal notranslate"><span class="pre">pwd</span></code> table on whichever machine the
indexer is running on. If false, then this gid is used <cite>as well as</cite> all of those
found using the <code class="docutils literal notranslate"><span class="pre">os.groups</span></code> command - which will read all groups found on the
machine the indexer is running on.</p>
</div>
<div class="section" id="cataloguer">
<h3>Cataloguer<a class="headerlink" href="#cataloguer" title="Permalink to this headline"></a></h3>
<p>The server config entry for the catalog consumer is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;catalog_q&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">standard_logging_dictionary</span><span class="p">},</span>
    <span class="s2">&quot;retry_delays&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="s2">&quot;print_tracebacks_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;db_engine&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;db_options&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;db_name&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;db_user&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;db_passwd&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;echo&quot;</span><span class="p">:</span> <span class="n">boolean</span>
    <span class="p">},</span>
    <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">logging</span></code>, <code class="docutils literal notranslate"><span class="pre">retry_delays</span></code>, and <code class="docutils literal notranslate"><span class="pre">print_tracebacks_fl</span></code> are, as above,
standard configurables within the NLDS consumer ecosystem. <code class="docutils literal notranslate"><span class="pre">max_retries</span></code> is
similarly available in the cataloguer, with the same meaning as above.</p>
<p>Here we also have two keys which control database behaviour via SQLAlchemy:
<code class="docutils literal notranslate"><span class="pre">db_engine</span></code> and <code class="docutils literal notranslate"><span class="pre">db_options</span></code>. <code class="docutils literal notranslate"><span class="pre">db_engine</span></code> is a string which specifies
which SQL flavour you would like SQLAlchemy. Currently this has been tried with
SQLite and PostgreSQL but, given how SQLAlchemy works, we expect few roadblocks
interacting with other database types. <code class="docutils literal notranslate"><span class="pre">db_options</span></code> is a further
sub-dictionary specifying the database name (which must be appropriate for
your chosen flavour of database), along with the database username and password
(if in use), respectively controlled by the keys <code class="docutils literal notranslate"><span class="pre">db_name</span></code>, <code class="docutils literal notranslate"><span class="pre">db_user</span></code>, and
<code class="docutils literal notranslate"><span class="pre">db_password</span></code>. Finally in this sub-dictionary <code class="docutils literal notranslate"><span class="pre">echo</span></code>, an optional
boolean flag which controls the auto-logging of the SQLAlchemy engine.</p>
</div>
<div class="section" id="transfer-put-and-transfer-get">
<h3>Transfer-put and Transfer-get<a class="headerlink" href="#transfer-put-and-transfer-get" title="Permalink to this headline"></a></h3>
<p>The server entry for the transfer-put consumer is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;transfer_put_q&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">standard_logging_dictionary</span><span class="p">},</span>
    <span class="s2">&quot;max_retries&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s2">&quot;retry_delays&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="s2">&quot;print_tracebacks_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;filelist_max_length&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="s2">&quot;check_permissions_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;use_pwd_gid_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;tenancy&quot;</span><span class="p">:</span> <span class="s2">&quot;cedadev-o.s3.jc.rl.ac.uk&quot;</span><span class="p">,</span>
    <span class="s2">&quot;require_secure_fl&quot;</span><span class="p">:</span> <span class="n">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where we have <code class="docutils literal notranslate"><span class="pre">logging</span></code>, <code class="docutils literal notranslate"><span class="pre">retry_delays</span></code> and <code class="docutils literal notranslate"><span class="pre">print_tracebacks_fl</span></code> as their
standard definitions defined above, and <code class="docutils literal notranslate"><span class="pre">max_retries</span></code>, <code class="docutils literal notranslate"><span class="pre">filelist_max_length</span></code>
, <code class="docutils literal notranslate"><span class="pre">check_permissions_fl</span></code>, and <code class="docutils literal notranslate"><span class="pre">use_pwd_gid_fl</span></code> defined the same as for the
Indexer consumer.</p>
<p>New definitions for the transfer processor are the <code class="docutils literal notranslate"><span class="pre">tenancy</span></code> and
<code class="docutils literal notranslate"><span class="pre">require_secure_fl</span></code>, which control <code class="docutils literal notranslate"><span class="pre">minio</span></code> behaviour. <code class="docutils literal notranslate"><span class="pre">tenancy</span></code> is a
string which denotes the address of the object store tenancy to upload/download
files to/from, and <code class="docutils literal notranslate"><span class="pre">require_secure_fl</span></code> which specifies whether or not you
require signed ssl certificates at the tenancy location.</p>
</div>
<div class="section" id="monitor">
<h3>Monitor<a class="headerlink" href="#monitor" title="Permalink to this headline"></a></h3>
<p>The server config entry for the monitor consumer is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;monitor_q&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">standard_logging_dictionary</span><span class="p">},</span>
    <span class="s2">&quot;retry_delays&quot;</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="s2">&quot;print_tracebacks_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
    <span class="s2">&quot;db_engine&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s2">&quot;db_options&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;db_name&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;db_user&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;db_passwd&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="s2">&quot;echo&quot;</span><span class="p">:</span> <span class="n">boolean</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">logging</span></code>, <code class="docutils literal notranslate"><span class="pre">retry_delays</span></code>, and <code class="docutils literal notranslate"><span class="pre">print_tracebacks_fl</span></code> have the
standard, previously stated definitions, and <code class="docutils literal notranslate"><span class="pre">db_engine</span></code> and <code class="docutils literal notranslate"><span class="pre">db_options</span></code>
are as defined for the Catalog consumer - due to the use of an SQL database on
the Monitor. Note the minimal retry control, as the monitor only retries
messages which failed due to an unexpected exception.</p>
</div>
<div class="section" id="logger">
<h3>Logger<a class="headerlink" href="#logger" title="Permalink to this headline"></a></h3>
<p>And finally, the server config entry for the Logger consumer is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;logging_q&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">standard_logging_dictionary</span><span class="p">},</span>
    <span class="s2">&quot;print_tracebacks_fl&quot;</span><span class="p">:</span> <span class="n">boolean</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where the options have been previously defined. Note that there is no special
configurable behaviour on the Logger consumer as it is simply a relay for
redirecting logging messages into log files. It should also be noted that the
<code class="docutils literal notranslate"><span class="pre">log_files</span></code> option should be set in the logging sub-dictionary for this to
work properly, which may be a mandatory setting in future versions.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../system-status.html" class="btn btn-neutral float-left" title="The System Status Monitor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2024, Neil Massey &amp; Jack Leland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>