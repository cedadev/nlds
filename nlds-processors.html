<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Core content of the nlds-processors &mdash; Near-line Data Store 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Core content of the nlds-server" href="nlds-server.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Near-line Data Store
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="home.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="specification.html">Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlds-server.html">NLDS Server API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NLDS Processors API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-nlds.rabbit.consumer">The Consumer class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-processors">The processors</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Near-line Data Store</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Core content of the nlds-processors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/nlds-processors.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="core-content-of-the-nlds-processors">
<h1>Core content of the nlds-processors<a class="headerlink" href="#core-content-of-the-nlds-processors" title="Permalink to this headline"></a></h1>
<div class="section" id="module-nlds.rabbit.consumer">
<span id="the-consumer-class"></span><h2>The Consumer class<a class="headerlink" href="#module-nlds.rabbit.consumer" title="Permalink to this headline"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.FilelistType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds.rabbit.consumer.</span></span><span class="sig-name descname"><span class="pre">FilelistType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.FilelistType" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></p>
<p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds.rabbit.consumer.</span></span><span class="sig-name descname"><span class="pre">RabbitMQConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setup_logging_fl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code>, <a class="reference internal" href="nlds-server.html#nlds.rabbit.publisher.RabbitMQPublisher" title="nlds.rabbit.publisher.RabbitMQPublisher"><code class="xref py py-class docutils literal notranslate"><span class="pre">nlds.rabbit.publisher.RabbitMQPublisher</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.acknowledge_message">
<span class="sig-name descname"><span class="pre">acknowledge_message</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.spec.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delivery_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.acknowledge_message" title="Permalink to this definition"></a></dt>
<dd><p>Method for acknowledging a message so the next can be fetched. This 
should be called at the end of a consumer callback, and - in order to do 
so thread-safely - from within connection object.  All of the required 
params come from the standard callback params.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channel</strong> – Callback channel param</p></li>
<li><p><strong>delivery_tag</strong> – From the callback method param. eg. 
method.delivery_tag</p></li>
<li><p><strong>connection</strong> – Connection object from the callback param</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.append_and_send">
<span class="sig-name descname"><span class="pre">append_and_send</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path_details</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nlds.details.PathDetails</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">routing_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filesize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">list_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds.rabbit.consumer.FilelistType" title="nlds.rabbit.consumer.FilelistType"><span class="pre">nlds.rabbit.consumer.FilelistType</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">FilelistType.processed</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.append_and_send" title="Permalink to this definition"></a></dt>
<dd><p>Append a path details item to an existing PathDetails list and then 
determine if said list requires sending to the exchange due to size 
limits (can be either file size or list length). Which pathlist is to 
be used is determined by the list_type passed, which can be either a 
FilelistType enum or an appropriate string that can be cast into one.</p>
<p>The list will by default be capped by list-length, with the maximum 
determined by a filelist_max_length config variable (defaults to 1000). 
This behaviour is overriden by specifying the filesize kwarg, which is 
in kilobytes and must be an integer, at consumption time.</p>
<p>The message body and destination should be specified through body_json 
and routing_key respectively.</p>
<p>NOTE: This was refactored here from the index/transfer processors. 
Might make more sense to put it somewhere else given there are specific 
config variables required (filelist_max_length, message_max_size) which 
could fail with an AttributeError?</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.callback">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.spec.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.amqp_object.Method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.check_path_access">
<span class="sig-name descname"><span class="pre">check_path_access</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stat_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">NamedTuple</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_permissions_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.check_path_access" title="Permalink to this definition"></a></dt>
<dd><p>Checks that the given path is accessible, either by checking for its 
existence or, if the check_permissions_fl is set, by doing a permissions
check on the file’s bitmask. This requires a stat of the file, so one 
must be provided via stat_result else one is performed. The uid and gid 
of the user must be set in the object as well, usually by having 
performed RabbitMQConsumer.set_ids() beforehand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.declare_bindings">
<span class="sig-name descname"><span class="pre">declare_bindings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.declare_bindings" title="Permalink to this definition"></a></dt>
<dd><p>Overridden method from Publisher, additionally declares the queues and 
queue-exchange bindings outlined in the config file. If no queues were 
set then the default - generated within __init__ - is used instead.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.load_config_value">
<span class="sig-name descname"><span class="pre">load_config_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_option</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_listify_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.load_config_value" title="Permalink to this definition"></a></dt>
<dd><p>Function for verification and loading of options from the consumer-
specific section of the .server_config file. Attempts to load from the 
config section and reverts to hardcoded default value if an error is 
encountered. Will not attempt to load an option if no default value is 
available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_option</strong> – (str) The option in the indexer section of the 
.server_config file to be verified and loaded.</p></li>
<li><p><strong>path_listify</strong> – (boolean) Optional argument to control whether 
value should be treated as a list and each item 
converted to a pathlib.Path() object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value at config_option, otherwise the default value as 
defined in Consumer.DEFAULT_CONSUMER_CONFIG. This is 
overloadable by</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.run" title="Permalink to this definition"></a></dt>
<dd><p>Method to run when thread is started. Creates an AMQP connection
and sets some exception handling.</p>
<p>A common exception which occurs is StreamLostError.
The connection should get reset if that happens.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.send_pathlist">
<span class="sig-name descname"><span class="pre">send_pathlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pathlist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">routing_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds.rabbit.consumer.FilelistType" title="nlds.rabbit.consumer.FilelistType"><span class="pre">nlds.rabbit.consumer.FilelistType</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">FilelistType.processed</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.send_pathlist" title="Permalink to this definition"></a></dt>
<dd><p>Convenience function which sends the given list of PathDetails 
objects to the exchange with the given routing key and message body. 
Mode specifies what to put into the log message, as well as determining 
whether the list should be retry-reset and whether the message should be 
delayed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.set_ids">
<span class="sig-name descname"><span class="pre">set_ids</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_pwd_gid_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.set_ids" title="Permalink to this definition"></a></dt>
<dd><p>Changes the real user- and group-ids stored in the class to that 
specified in the incoming message details section so that permissions 
on each file in a filelist can be checked.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.setup_logging">
<span class="sig-name descname"><span class="pre">setup_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_stdout_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stdout_log_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_files</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_rollover</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.setup_logging" title="Permalink to this definition"></a></dt>
<dd><p>Override of the publisher method which allows consumer-specific logging 
to take precedence over the general logging configuration.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.split_routing_key">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">split_routing_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">routing_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.split_routing_key" title="Permalink to this definition"></a></dt>
<dd><p>Method to simply verify and split the routing key into parts.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>3-tuple of routing key parts</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="the-processors">
<h2>The processors<a class="headerlink" href="#the-processors" title="Permalink to this headline"></a></h2>
<p>Also referred to as ‘microservices’</p>
<span class="target" id="module-nlds_processors.index"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.index.</span></span><span class="sig-name descname"><span class="pre">IndexerConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'index_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.check_path_access">
<span class="sig-name descname"><span class="pre">check_path_access</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stat_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">NamedTuple</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.check_path_access" title="Permalink to this definition"></a></dt>
<dd><p>Checks that the given path is accessible, either by checking for its 
existence or, if the check_permissions_fl is set, by doing a permissions
check on the file’s bitmask. This requires a stat of the file, so one 
must be provided via stat_result else one is performed. The uid and gid 
of the user must be set in the object as well, usually by having 
performed RabbitMQConsumer.set_ids() beforehand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.index">
<span class="sig-name descname"><span class="pre">index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_filelist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">NamedTuple</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rk_origin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.index" title="Permalink to this definition"></a></dt>
<dd><p>Indexes a list of PathDetails.</p>
<p>Each IndexItem is a named tuple consisting of an item (a file or 
directory) and an associated number of attempted accesses. This function
checks if each item exists, fully walking any directories and 
subdirectories in the process, and then checks permissions on each 
available file. All accessible files are added to an ‘indexed’ list and 
sent back to the exchange for transfer once that list has reached a 
pre-configured size (default 1000MB) or the end of IndexItem list has 
been reached, whichever comes first.</p>
<p>If any item cannot be found, indexed or accessed then it is added to a 
‘problem’ list for another attempt at indexing. If a maximum number of 
retries is reached and the item has still not been indexed then it is 
added to a final ‘failed’ list which is sent back to the exchange so the
user can be informed via monitoring.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_filelist</strong> (<em>List</em><em>[</em><em>NamedTuple</em><em>]</em>) – List of IndexItems containing 
paths to files or indexable directories and the number of times each 
has been attempted to be indexed.</p></li>
<li><p><strong>rk_origin</strong> (<em>str</em>) – The first section of the received message’s 
routing key which designates its origin.</p></li>
<li><p><strong>body_json</strong> (<em>dict</em>) – The message body in dict form.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.split">
<span class="sig-name descname"><span class="pre">split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rk_origin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.split" title="Permalink to this definition"></a></dt>
<dd><p>Split the given filelist into batches of some configurable max 
length and resubmit each to exchange for indexing proper.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.catalog"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.CatalogConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.</span></span><span class="sig-name descname"><span class="pre">CatalogConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'catalog_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.CatalogConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.CatalogConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.channel.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.catalog.CatalogConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.monitor"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.MonitorConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.</span></span><span class="sig-name descname"><span class="pre">MonitorConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'monitor_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.MonitorConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.MonitorConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.MonitorConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.logger"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.logger.LoggingConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.logger.</span></span><span class="sig-name descname"><span class="pre">LoggingConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'logging_q'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setup_logging_fl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.logger.LoggingConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.logger.LoggingConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.logger.LoggingConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.logger.LoggingConsumer.get_logging_func">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_logging_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_level:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger_like:</span> <span class="pre">logging.Logger</span> <span class="pre">=</span> <span class="pre">&lt;Logger</span> <span class="pre">nlds.root</span> <span class="pre">(WARNING)&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.logger.LoggingConsumer.get_logging_func" title="Permalink to this definition"></a></dt>
<dd><p>Selects the appropriate logging function, given a logging level, from a 
Logger object or Logger-like object. The global logger is used by 
default (logging.getLogger(__name__)) but anything which has the 
standard logging operations (debug, info, warning etc. ) can be used 
i.e. the logging package</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_level</strong> (<em>str</em>) – Logging level requested</p></li>
<li><p><strong>logger_like</strong> (<em>Logger</em>) – Logger object to get function from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The logging function to use</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nlds-server.html" class="btn btn-neutral float-left" title="Core content of the nlds-server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Neil Massey &amp; Jack Leland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>