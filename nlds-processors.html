<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Microservices &mdash; Near-line Data Store 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Database Migrations with Alembic" href="alembic-migrations.html" />
    <link rel="prev" title="NLDS API-server" href="nlds-server.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/ceda.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="home.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="specification.html">Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="nlds-server.html">NLDS Server API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">NLDS Processors API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-nlds.rabbit.consumer">The Consumer class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-processors">The processors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="alembic-migrations.html">Database Migrations with Alembic</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="server-config/server-config.html">The server config file</a></li>
<li class="toctree-l1"><a class="reference internal" href="server-config/examples.html">Server config examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="cta-emulator.html">Setting up a CTA tape emulator</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-status.html">Using system status</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Near-line Data Store</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Microservices</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/nlds-processors.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="microservices">
<h1>Microservices<a class="headerlink" href="#microservices" title="Permalink to this headline"></a></h1>
<p>Core content of the nlds-processors.</p>
<div class="section" id="module-nlds.rabbit.consumer">
<span id="the-consumer-class"></span><h2>The Consumer class<a class="headerlink" href="#module-nlds.rabbit.consumer" title="Permalink to this headline"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.FilelistType">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds.rabbit.consumer.</span></span><span class="sig-name descname"><span class="pre">FilelistType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.FilelistType" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></p>
<p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds.rabbit.consumer.</span></span><span class="sig-name descname"><span class="pre">RabbitMQConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setup_logging_fl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code>, <a class="reference internal" href="nlds-server.html#nlds.rabbit.publisher.RabbitMQPublisher" title="nlds.rabbit.publisher.RabbitMQPublisher"><code class="xref py py-class docutils literal notranslate"><span class="pre">nlds.rabbit.publisher.RabbitMQPublisher</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.acknowledge_message">
<span class="sig-name descname"><span class="pre">acknowledge_message</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.spec.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delivery_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.acknowledge_message" title="Permalink to this definition"></a></dt>
<dd><p>Method for acknowledging a message so the next can be fetched. This 
should be called at the end of a consumer callback, and - in order to do 
so thread-safely - from within connection object.  All of the required 
params come from the standard callback params.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channel</strong> – Callback channel param</p></li>
<li><p><strong>delivery_tag</strong> – From the callback method param. eg. 
method.delivery_tag</p></li>
<li><p><strong>connection</strong> – Connection object from the callback param</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.callback">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.spec.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.amqp_object.Method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.declare_bindings">
<span class="sig-name descname"><span class="pre">declare_bindings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.declare_bindings" title="Permalink to this definition"></a></dt>
<dd><p>Overridden method from Publisher, additionally declares the queues and 
queue-exchange bindings outlined in the config file. If no queues were 
set then the default - generated within __init__ - is used instead.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.dedup_filelist">
<span class="sig-name descname"><span class="pre">dedup_filelist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.dedup_filelist" title="Permalink to this definition"></a></dt>
<dd><p>De-duplicate filelist</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.get_retries">
<span class="sig-name descname"><span class="pre">get_retries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">nlds.details.Retries</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.get_retries" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve the retries from a message. If no present or inaccessible 
then add new ones.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.load_config_value">
<span class="sig-name descname"><span class="pre">load_config_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_option</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_listify_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.load_config_value" title="Permalink to this definition"></a></dt>
<dd><p>Function for verification and loading of options from the consumer-
specific section of the .server_config file. Attempts to load from the 
config section and reverts to hardcoded default value if an error is 
encountered. Will not attempt to load an option if no default value is 
available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_option</strong> – (str) The option in the indexer section of the 
.server_config file to be verified and loaded.</p></li>
<li><p><strong>path_listify</strong> – (boolean) Optional argument to control whether 
value should be treated as a list and each item 
converted to a pathlib.Path() object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value at config_option, otherwise the default value as 
defined in Consumer.DEFAULT_CONSUMER_CONFIG. This is 
overloadable by</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.nack_message">
<span class="sig-name descname"><span class="pre">nack_message</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.spec.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delivery_tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.nack_message" title="Permalink to this definition"></a></dt>
<dd><p>Method for nacknowledging a message so that it can be requeued and 
the next can be fetched. This is called after a consumer callback if, 
and only if, it returns a False. As in the case of acking, in order to 
do this thread-safely it is done from within a connection object.  All 
of the required params come from the standard callback params.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>channel</strong> – Callback channel param</p></li>
<li><p><strong>delivery_tag</strong> – From the callback method param. eg. 
method.delivery_tag</p></li>
<li><p><strong>connection</strong> – Connection object from the callback param</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.parse_filelist">
<span class="sig-name descname"><span class="pre">parse_filelist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.parse_filelist" title="Permalink to this definition"></a></dt>
<dd><p>Convert flat list from message json into list of PathDetails objects 
and the check it is, in fact, a list</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.run">
<span class="sig-name descname"><span class="pre">run</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.run" title="Permalink to this definition"></a></dt>
<dd><p>Method to run when thread is started. Creates an AMQP connection
and sets some exception handling.</p>
<p>A common exception which occurs is StreamLostError.
The connection should get reset if that happens.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.send_pathlist">
<span class="sig-name descname"><span class="pre">send_pathlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pathlist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">routing_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds.rabbit.consumer.State" title="nlds.rabbit.consumer.State"><span class="pre">nlds.rabbit.consumer.State</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds.rabbit.consumer.FilelistType" title="nlds.rabbit.consumer.FilelistType"><span class="pre">nlds.rabbit.consumer.FilelistType</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">FilelistType.processed</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warning</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delay</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_reasons_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.send_pathlist" title="Permalink to this definition"></a></dt>
<dd><p>Convenience function which sends the given list of PathDetails 
objects to the exchange with the given routing key and message body. 
Mode specifies what to put into the log message, as well as determining 
whether the list should be retry-reset and whether the message should be 
delayed. Optionally, when resetting the retries the retry-reasons can be 
saved for later perusal by setting the save_reasons_fl.</p>
<p>Additionally forwards transaction state info on to the monitor. As part 
of this it keeps track of the number of messages sent and reassigns 
message sub_ids appropriately so that monitoring can keep track of the 
transaction’s state more easily.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.setup_logging">
<span class="sig-name descname"><span class="pre">setup_logging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_stdout_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stdout_log_level</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_files</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_rollover</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.setup_logging" title="Permalink to this definition"></a></dt>
<dd><p>Override of the publisher method which allows consumer-specific logging 
to take precedence over the general logging configuration.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.RabbitMQConsumer.split_routing_key">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">split_routing_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">routing_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds.rabbit.consumer.RabbitMQConsumer.split_routing_key" title="Permalink to this definition"></a></dt>
<dd><p>Method to simply verify and split the routing key into parts.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>3-tuple of routing key parts</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.SigTermError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds.rabbit.consumer.</span></span><span class="sig-name descname"><span class="pre">SigTermError</span></span><a class="headerlink" href="#nlds.rabbit.consumer.SigTermError" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Exception</span></code></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds.rabbit.consumer.State">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds.rabbit.consumer.</span></span><span class="sig-name descname"><span class="pre">State</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds.rabbit.consumer.State" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">enum.Enum</span></code></p>
<p>An enumeration.</p>
</dd></dl>

</div>
<div class="section" id="the-processors">
<h2>The processors<a class="headerlink" href="#the-processors" title="Permalink to this headline"></a></h2>
<p>Also referred to as ‘microservices’, ‘consumers’, or ‘workers’:</p>
<span class="target" id="module-nlds_processors.nlds_worker"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.nlds_worker.NLDSWorkerConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.nlds_worker.</span></span><span class="sig-name descname"><span class="pre">NLDSWorkerConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nlds_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.nlds_worker.NLDSWorkerConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.nlds_worker.NLDSWorkerConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.channel.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.nlds_worker.NLDSWorkerConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.nlds_worker.NLDSWorkerConsumer.publish_and_log_message">
<span class="sig-name descname"><span class="pre">publish_and_log_message</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">routing_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log_fl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.nlds_worker.NLDSWorkerConsumer.publish_and_log_message" title="Permalink to this definition"></a></dt>
<dd><p>Wrapper around original publish message to additionally send message to 
logging queue. Useful for debugging purposes to be able to see the 
content being managed by the worker.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.index"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.index.</span></span><span class="sig-name descname"><span class="pre">IndexerConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'index_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.check_path_access">
<span class="sig-name descname"><span class="pre">check_path_access</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stat_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">NamedTuple</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.check_path_access" title="Permalink to this definition"></a></dt>
<dd><p>Checks that the given path is accessible, either by checking for its 
existence or, if the check_permissions_fl is set, by doing a permissions
check on the file’s bitmask. This requires a stat of the file, so one 
must be provided via stat_result else one is performed. The uid and gid 
of the user must be set in the object as well, usually by having 
performed RabbitMQConsumer.set_ids() beforehand.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.index">
<span class="sig-name descname"><span class="pre">index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_filelist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">NamedTuple</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rk_origin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.index" title="Permalink to this definition"></a></dt>
<dd><p>Indexes a list of PathDetails.</p>
<p>Each IndexItem is a named tuple consisting of an item (a file or 
directory) and an associated number of attempted accesses. This function
checks if each item exists, fully walking any directories and 
subdirectories in the process, and then checks permissions on each 
available file. All accessible files are added to an ‘indexed’ list and 
sent back to the exchange for transfer once that list has reached a 
pre-configured size (default 1000MB) or the end of IndexItem list has 
been reached, whichever comes first.</p>
<p>If any item cannot be found, indexed or accessed then it is added to a 
‘problem’ list for another attempt at indexing. If a maximum number of 
retries is reached and the item has still not been indexed then it is 
added to a final ‘failed’ list which is sent back to the exchange so the
user can be informed via monitoring.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>raw_filelist</strong> (<em>List</em><em>[</em><em>NamedTuple</em><em>]</em>) – List of IndexItems containing 
paths to files or indexable directories and the number of times each 
has been attempted to be indexed.</p></li>
<li><p><strong>rk_origin</strong> (<em>str</em>) – The first section of the received message’s 
routing key which designates its origin.</p></li>
<li><p><strong>body_json</strong> (<em>dict</em>) – The message body in dict form.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.index.IndexerConsumer.split">
<span class="sig-name descname"><span class="pre">split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">nlds.details.PathDetails</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rk_origin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.index.IndexerConsumer.split" title="Permalink to this definition"></a></dt>
<dd><p>Split the given filelist into batches of some configurable max 
length and resubmit each to exchange for indexing proper.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.transferers.base_transfer"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.transferers.base_transfer.BaseTransferConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.transferers.base_transfer.</span></span><span class="sig-name descname"><span class="pre">BaseTransferConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'transfer_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.transferers.base_transfer.BaseTransferConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.transferers.base_transfer.BaseTransferConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.transferers.base_transfer.BaseTransferConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.transferers.base_transfer.BaseTransferConsumer.check_path_access">
<span class="sig-name descname"><span class="pre">check_path_access</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pathlib.Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stat_result</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">NamedTuple</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#nlds_processors.transferers.base_transfer.BaseTransferConsumer.check_path_access" title="Permalink to this definition"></a></dt>
<dd><p>Checks that the given path is accessible, either by checking for its 
existence or, if the check_permissions_fl is set, by doing a permissions
check on the file’s bitmask. This requires a stat of the file, so one 
must be provided via stat_result else one is performed. The uid and gid 
of the user must be set in the object as well, usually by having 
performed RabbitMQConsumer.set_ids() beforehand.</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="nlds_processors.transferers.base_transfer.TransferError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.transferers.base_transfer.</span></span><span class="sig-name descname"><span class="pre">TransferError</span></span><a class="headerlink" href="#nlds_processors.transferers.base_transfer.TransferError" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<span class="target" id="module-nlds_processors.transferers.put_transfer"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.transferers.put_transfer.PutTransferConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.transferers.put_transfer.</span></span><span class="sig-name descname"><span class="pre">PutTransferConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'transfer_put_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.transferers.put_transfer.PutTransferConsumer" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<span class="target" id="module-nlds_processors.db_mixin"></span><dl class="py exception">
<dt class="sig sig-object py" id="nlds_processors.db_mixin.DBError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.db_mixin.</span></span><span class="sig-name descname"><span class="pre">DBError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.db_mixin.DBError" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.db_mixin.DBMixin">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.db_mixin.</span></span><span class="sig-name descname"><span class="pre">DBMixin</span></span><a class="headerlink" href="#nlds_processors.db_mixin.DBMixin" title="Permalink to this definition"></a></dt>
<dd><p>Mixin refactored from monitor and catalog classes</p>
<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.db_mixin.DBMixin.end_session">
<span class="sig-name descname"><span class="pre">end_session</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.db_mixin.DBMixin.end_session" title="Permalink to this definition"></a></dt>
<dd><p>Close the SQL alchemy session</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.db_mixin.DBMixin.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.db_mixin.DBMixin.save" title="Permalink to this definition"></a></dt>
<dd><p>Commit all pending transactions</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.db_mixin.DBMixin.start_session">
<span class="sig-name descname"><span class="pre">start_session</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.db_mixin.DBMixin.start_session" title="Permalink to this definition"></a></dt>
<dd><p>Create a SQL alchemy session</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.catalog.catalog_models"></span><p>Declare the SQLAlchemy ORM models for the NLDS Catalog database</p>
<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Aggregation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Class containing the details of file aggregations made for writing files 
to tape (specifically CTA) as tars</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Checksum">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Checksum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Checksum" title="Permalink to this definition"></a></dt>
<dd><p>Class containing checksum and algorithm used to calculate checksum</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.File">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">File</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.File" title="Permalink to this definition"></a></dt>
<dd><p>Class containing the details of a single File</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Holding">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Holding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Holding" title="Permalink to this definition"></a></dt>
<dd><p>Class containing the details of a Holding - i.e. a batch</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Location">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Location</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Location" title="Permalink to this definition"></a></dt>
<dd><p>Class containing the location on NLDS of a single File</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Storage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Storage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Storage" title="Permalink to this definition"></a></dt>
<dd><p>An enumeration.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Tag">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Tag" title="Permalink to this definition"></a></dt>
<dd><p>Class containing the details of a Tag that can be assigned to a Holding</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_models.Transaction">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_models.</span></span><span class="sig-name descname"><span class="pre">Transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_models.Transaction" title="Permalink to this definition"></a></dt>
<dd><p>Class containing details of a transaction.  Note that a holding can 
consist of many transactions.</p>
</dd></dl>

<span class="target" id="module-nlds_processors.catalog.catalog"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog.</span></span><span class="sig-name descname"><span class="pre">Catalog</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog" title="Permalink to this definition"></a></dt>
<dd><p>Catalog object containing methods to manipulate the Catalog Database</p>
<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.create_aggregation">
<span class="sig-name descname"><span class="pre">create_aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tarname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">checksum</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">algorithm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">failed_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.create_aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Create an aggregation of files to write to tape as a tar file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.create_file">
<span class="sig-name descname"><span class="pre">create_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Transaction" title="nlds_processors.catalog.catalog_models.Transaction"><span class="pre">nlds_processors.catalog.catalog_models.Transaction</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">link_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_permissions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.create_file" title="Permalink to this definition"></a></dt>
<dd><p>Create a file that belongs to a transaction and will contain 
locations</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.create_holding">
<span class="sig-name descname"><span class="pre">create_holding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.create_holding" title="Permalink to this definition"></a></dt>
<dd><p>Create the new Holding with the label, user, group</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.create_location">
<span class="sig-name descname"><span class="pre">create_location</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sqlalchemy.sql.sqltypes.Enum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url_scheme</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">url_netloc</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">root</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">access_time</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">aggregation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Location" title="nlds_processors.catalog.catalog_models.Location"><span class="pre">nlds_processors.catalog.catalog_models.Location</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.create_location" title="Permalink to this definition"></a></dt>
<dd><p>Add the storage location for either object storage or tape</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.create_tag">
<span class="sig-name descname"><span class="pre">create_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.create_tag" title="Permalink to this definition"></a></dt>
<dd><p>Create a tag and add it to a holding</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.create_transaction">
<span class="sig-name descname"><span class="pre">create_transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Transaction" title="nlds_processors.catalog.catalog_models.Transaction"><span class="pre">nlds_processors.catalog.catalog_models.Transaction</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.create_transaction" title="Permalink to this definition"></a></dt>
<dd><p>Create a transaction that belongs to a holding and will contain files</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.del_tag">
<span class="sig-name descname"><span class="pre">del_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.del_tag" title="Permalink to this definition"></a></dt>
<dd><p>Delete a tag that has the key</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.delete_aggregation">
<span class="sig-name descname"><span class="pre">delete_aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aggregation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.delete_aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Delete a given aggregation</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.delete_files">
<span class="sig-name descname"><span class="pre">delete_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">holding_label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">holding_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.delete_files" title="Permalink to this definition"></a></dt>
<dd><p>Delete a given path from the catalog. If a holding is specified only 
the matching file from that holding will be deleted, otherwise all 
matching files will. Utilises get_files().</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.delete_location">
<span class="sig-name descname"><span class="pre">delete_location</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sqlalchemy.sql.sqltypes.Enum</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.delete_location" title="Permalink to this definition"></a></dt>
<dd><p>Delete the location for a given file and storage_type</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.fail_aggregation">
<span class="sig-name descname"><span class="pre">fail_aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aggregation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.fail_aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Mark an aggregation as failed, as the final step of a failed 
archive-put.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_aggregation">
<span class="sig-name descname"><span class="pre">get_aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aggregation_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Simple function for getting of Aggregation from aggregation_id.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_aggregation_by_file">
<span class="sig-name descname"><span class="pre">get_aggregation_by_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Storage" title="nlds_processors.catalog.catalog_models.Storage"><span class="pre">nlds_processors.catalog.catalog_models.Storage</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Storage.TAPE</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_aggregation_by_file" title="Permalink to this definition"></a></dt>
<dd><p>Get the aggregation associated with a particular file’s location on 
tape. Storage type has been left as a kwarg in case future storage types 
are added which will utilise aggregations.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_files">
<span class="sig-name descname"><span class="pre">get_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupall</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">holding_label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">holding_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">original_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_files" title="Permalink to this definition"></a></dt>
<dd><p>Get a multitude of file details from the database, given the user,
group, label, holding_id, path (can be regex) or tag(s)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_holding">
<span class="sig-name descname"><span class="pre">get_holding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupall</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">holding_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_holding" title="Permalink to this definition"></a></dt>
<dd><p>Get a holding from the database</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_location">
<span class="sig-name descname"><span class="pre">get_location</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">storage_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">sqlalchemy.sql.sqltypes.Enum</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Location" title="nlds_processors.catalog.catalog_models.Location"><span class="pre">nlds_processors.catalog.catalog_models.Location</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_location" title="Permalink to this definition"></a></dt>
<dd><p>Get a storage location for a file, given the file and the storage
type</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_location_file">
<span class="sig-name descname"><span class="pre">get_location_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">location</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Location" title="nlds_processors.catalog.catalog_models.Location"><span class="pre">nlds_processors.catalog.catalog_models.Location</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_location_file" title="Permalink to this definition"></a></dt>
<dd><p>Get a File but from the other end of the database tree, starting from
a location.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_location_transaction">
<span class="sig-name descname"><span class="pre">get_location_transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">location</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Location" title="nlds_processors.catalog.catalog_models.Location"><span class="pre">nlds_processors.catalog.catalog_models.Location</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Transaction" title="nlds_processors.catalog.catalog_models.Transaction"><span class="pre">nlds_processors.catalog.catalog_models.Transaction</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_location_transaction" title="Permalink to this definition"></a></dt>
<dd><p>Get a transaction but from the other end of the database tree, from a
location’s file_id.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_next_holding">
<span class="sig-name descname"><span class="pre">get_next_holding</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_next_holding" title="Permalink to this definition"></a></dt>
<dd><p>The principal function for getting the next unarchived holding to 
archive aggregate.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_tag">
<span class="sig-name descname"><span class="pre">get_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_tag" title="Permalink to this definition"></a></dt>
<dd><p>Get the tag with a specific key</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_transaction">
<span class="sig-name descname"><span class="pre">get_transaction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Transaction" title="nlds_processors.catalog.catalog_models.Transaction"><span class="pre">nlds_processors.catalog.catalog_models.Transaction</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_transaction" title="Permalink to this definition"></a></dt>
<dd><p>Get a transaction from the database</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.get_unarchived_files">
<span class="sig-name descname"><span class="pre">get_unarchived_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.get_unarchived_files" title="Permalink to this definition"></a></dt>
<dd><p>The principal function for getting unarchived files to aggregate and 
send to archive put.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.modify_holding">
<span class="sig-name descname"><span class="pre">modify_holding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_tags</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">del_tags</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.modify_holding" title="Permalink to this definition"></a></dt>
<dd><p>Find a holding and modify the information in it</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.modify_tag">
<span class="sig-name descname"><span class="pre">modify_tag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">holding</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Holding" title="nlds_processors.catalog.catalog_models.Holding"><span class="pre">nlds_processors.catalog.catalog_models.Holding</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.modify_tag" title="Permalink to this definition"></a></dt>
<dd><p>Modify a tag that has the key, with a new value.
Tag has to exist, current value will be overwritten.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.Catalog.update_aggregation">
<span class="sig-name descname"><span class="pre">update_aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aggregation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">checksum</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">algorithm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tarname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.catalog.catalog_models.Aggregation" title="nlds_processors.catalog.catalog_models.Aggregation"><span class="pre">nlds_processors.catalog.catalog_models.Aggregation</span></a></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog.Catalog.update_aggregation" title="Permalink to this definition"></a></dt>
<dd><p>Add a missing checksum &amp; algorithm to an aggregation after a 
successful write to tape. Can also optionally rename the tarname, at 
which point the</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog.CatalogError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog.</span></span><span class="sig-name descname"><span class="pre">CatalogError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog.CatalogError" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<span class="target" id="module-nlds_processors.catalog.catalog_worker"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_worker.CatalogConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_worker.</span></span><span class="sig-name descname"><span class="pre">CatalogConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'catalog_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_worker.CatalogConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_worker.CatalogConsumer.aggregate_files">
<span class="sig-name descname"><span class="pre">aggregate_files</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filelist</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_agg_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds_processors.catalog.catalog_models.File" title="nlds_processors.catalog.catalog_models.File"><span class="pre">nlds_processors.catalog.catalog_models.File</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog_worker.CatalogConsumer.aggregate_files" title="Permalink to this definition"></a></dt>
<dd><p>Creates a list of suitable aggregations from a given list of files. A
few algorithms for this were explored, with some suiting different 
distributions of file sizes better, so the most generic solution is 
provided. This implementation calculates a target value for aggregation 
size, configurable through server-config, and then iterates through the 
Files and sorts each into the smallest aggregation available at that 
iteration.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_worker.CatalogConsumer.attach_database">
<span class="sig-name descname"><span class="pre">attach_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">create_db_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_worker.CatalogConsumer.attach_database" title="Permalink to this definition"></a></dt>
<dd><p>Attach the Catalog to the consumer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_worker.CatalogConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.channel.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.catalog.catalog_worker.CatalogConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_worker.CatalogConsumer.get_url">
<span class="sig-name descname"><span class="pre">get_url</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_worker.CatalogConsumer.get_url" title="Permalink to this definition"></a></dt>
<dd><p>Method for making the sqlalchemy url available to alembic</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.catalog.catalog_worker.Metadata">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.catalog.catalog_worker.</span></span><span class="sig-name descname"><span class="pre">Metadata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.catalog.catalog_worker.Metadata" title="Permalink to this definition"></a></dt>
<dd><p>Container class for the meta section of the message body.</p>
</dd></dl>

<span class="target" id="module-nlds_processors.monitor.monitor_models"></span><p>Declare the SQLAlchemy ORM models for the NLDS Monitoring database</p>
<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_models.FailedFile">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor_models.</span></span><span class="sig-name descname"><span class="pre">FailedFile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_models.FailedFile" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_models.SubRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor_models.</span></span><span class="sig-name descname"><span class="pre">SubRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_models.SubRecord" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_models.SubRecord.has_finished">
<span class="sig-name descname"><span class="pre">has_finished</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_models.SubRecord.has_finished" title="Permalink to this definition"></a></dt>
<dd><p>Convenience method for checking whether a given SubRecord is in a 
‘final’ state, i.e. is no longer going to change and the transaction can 
therefore be marked as COMPLETE.</p>
<p>Checks whether all states have gotten to the final stage of a workflow 
(CATALOG_PUT or TRANSFER_GET) and are not retrying, OR have failed. This
should cover all bases.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_models.TransactionRecord">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor_models.</span></span><span class="sig-name descname"><span class="pre">TransactionRecord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_models.TransactionRecord" title="Permalink to this definition"></a></dt>
<dd><p>Class containing the details of the state of a transaction</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_models.Warning">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor_models.</span></span><span class="sig-name descname"><span class="pre">Warning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_models.Warning" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<span class="target" id="module-nlds_processors.monitor.monitor"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor.</span></span><span class="sig-name descname"><span class="pre">Monitor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">db_engine</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_options</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor" title="Permalink to this definition"></a></dt>
<dd><p>Monitor object containing methods to manipulate the Monitor Database</p>
<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.check_completion">
<span class="sig-name descname"><span class="pre">check_completion</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.TransactionRecord" title="nlds_processors.monitor.monitor_models.TransactionRecord"><span class="pre">nlds_processors.monitor.monitor_models.TransactionRecord</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.check_completion" title="Permalink to this definition"></a></dt>
<dd><p>Get the complete list of sub records from a transaction record and 
check whether they are all in a final state, and update them to COMPLETE
if so.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.create_failed_file">
<span class="sig-name descname"><span class="pre">create_failed_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.SubRecord" title="nlds_processors.monitor.monitor_models.SubRecord"><span class="pre">nlds_processors.monitor.monitor_models.SubRecord</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_details</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">nlds.details.PathDetails</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reason</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.FailedFile" title="nlds_processors.monitor.monitor_models.FailedFile"><span class="pre">nlds_processors.monitor.monitor_models.FailedFile</span></a></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.create_failed_file" title="Permalink to this definition"></a></dt>
<dd><p>Creates a FailedFile object for the monitoring database. Requires the 
input of the parent SubRecord and the PathDetails object of the failed 
file in question. Optionally requires a reason str, which will otherwise 
be attempted to be taken from the PathDetails object. If no reason can 
be found then a MonitorError will be raised.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.create_sub_record">
<span class="sig-name descname"><span class="pre">create_sub_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.TransactionRecord" title="nlds_processors.monitor.monitor_models.TransactionRecord"><span class="pre">nlds_processors.monitor.monitor_models.TransactionRecord</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds.rabbit.consumer.State" title="nlds.rabbit.consumer.State"><span class="pre">nlds.rabbit.consumer.State</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.SubRecord" title="nlds_processors.monitor.monitor_models.SubRecord"><span class="pre">nlds_processors.monitor.monitor_models.SubRecord</span></a></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.create_sub_record" title="Permalink to this definition"></a></dt>
<dd><p>Creates a SubRecord with the minimum required input. Optionally adds 
to a session and flushes to get the id field populated.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.create_transaction_record">
<span class="sig-name descname"><span class="pre">create_transaction_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.TransactionRecord" title="nlds_processors.monitor.monitor_models.TransactionRecord"><span class="pre">nlds_processors.monitor.monitor_models.TransactionRecord</span></a></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.create_transaction_record" title="Permalink to this definition"></a></dt>
<dd><p>Creates a transaction_record with the minimum required input</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.create_warning">
<span class="sig-name descname"><span class="pre">create_warning</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.TransactionRecord" title="nlds_processors.monitor.monitor_models.TransactionRecord"><span class="pre">nlds_processors.monitor.monitor_models.TransactionRecord</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">warning</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.Warning" title="nlds_processors.monitor.monitor_models.Warning"><span class="pre">nlds_processors.monitor.monitor_models.Warning</span></a></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.create_warning" title="Permalink to this definition"></a></dt>
<dd><p>Create a warning and add it to the TransactionRecord</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.get_sub_record">
<span class="sig-name descname"><span class="pre">get_sub_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.SubRecord" title="nlds_processors.monitor.monitor_models.SubRecord"><span class="pre">nlds_processors.monitor.monitor_models.SubRecord</span></a></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.get_sub_record" title="Permalink to this definition"></a></dt>
<dd><p>Return a single sub record identified by the sub_id</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.get_sub_records">
<span class="sig-name descname"><span class="pre">get_sub_records</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">transaction_record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.TransactionRecord" title="nlds_processors.monitor.monitor_models.TransactionRecord"><span class="pre">nlds_processors.monitor.monitor_models.TransactionRecord</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">sub_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#nlds.rabbit.consumer.State" title="nlds.rabbit.consumer.State"><span class="pre">nlds.rabbit.consumer.State</span></a><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">api_action</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.get_sub_records" title="Permalink to this definition"></a></dt>
<dd><p>Return many sub records, identified by one of the (many) function
parameters</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.get_transaction_record">
<span class="sig-name descname"><span class="pre">get_transaction_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupall</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idd</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transaction_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_label</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.get_transaction_record" title="Permalink to this definition"></a></dt>
<dd><p>Gets a TransactionRecord from the DB from the given transaction_id,
or the primary key (id)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.Monitor.update_sub_record">
<span class="sig-name descname"><span class="pre">update_sub_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_record</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.SubRecord" title="nlds_processors.monitor.monitor_models.SubRecord"><span class="pre">nlds_processors.monitor.monitor_models.SubRecord</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#nlds.rabbit.consumer.State" title="nlds.rabbit.consumer.State"><span class="pre">nlds.rabbit.consumer.State</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#nlds_processors.monitor.monitor_models.SubRecord" title="nlds_processors.monitor.monitor_models.SubRecord"><span class="pre">nlds_processors.monitor.monitor_models.SubRecord</span></a></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor.Monitor.update_sub_record" title="Permalink to this definition"></a></dt>
<dd><p>Update a retrieved SubRecord to reflect the new monitoring info. 
Furthest state is updated, if required, and the retry count is 
incremented by one if appropriate.
TODO: Should retrying be a flag instead of a separate state? Probably, 
yes</p>
</dd></dl>

</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor.MonitorError">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor.</span></span><span class="sig-name descname"><span class="pre">MonitorError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor.MonitorError" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<span class="target" id="module-nlds_processors.monitor.monitor_worker"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_worker.MonitorConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.monitor.monitor_worker.</span></span><span class="sig-name descname"><span class="pre">MonitorConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'monitor_q'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_worker.MonitorConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_worker.MonitorConsumer.attach_database">
<span class="sig-name descname"><span class="pre">attach_database</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">create_db_fl</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_worker.MonitorConsumer.attach_database" title="Permalink to this definition"></a></dt>
<dd><p>Attach the Monitor to the consumer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_worker.MonitorConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.channel.Channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.frame.Header</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bytes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pika.connection.Connection</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#nlds_processors.monitor.monitor_worker.MonitorConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.monitor.monitor_worker.MonitorConsumer.get_url">
<span class="sig-name descname"><span class="pre">get_url</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.monitor.monitor_worker.MonitorConsumer.get_url" title="Permalink to this definition"></a></dt>
<dd><p>Method for making the sqlalchemy url available to alembic</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-nlds_processors.logger"></span><dl class="py class">
<dt class="sig sig-object py" id="nlds_processors.logger.LoggingConsumer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">nlds_processors.logger.</span></span><span class="sig-name descname"><span class="pre">LoggingConsumer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">queue</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'logging_q'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">setup_logging_fl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.logger.LoggingConsumer" title="Permalink to this definition"></a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.logger.LoggingConsumer.callback">
<span class="sig-name descname"><span class="pre">callback</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">properties</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.logger.LoggingConsumer.callback" title="Permalink to this definition"></a></dt>
<dd><p>Standard consumer callback function as defined by rabbitMQ, with the 
standard callback parameters of Channel, Method, Header, Body (in bytes)
and Connection.</p>
<p>This is the working method of a consumer, i.e. it does the job the 
consumer has been designed to do, and so must be implemented and 
overridden by any child consumer classes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="nlds_processors.logger.LoggingConsumer.get_logging_func">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_logging_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_level:</span> <span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger_like:</span> <span class="pre">logging.Logger</span> <span class="pre">=</span> <span class="pre">&lt;Logger</span> <span class="pre">nlds.root</span> <span class="pre">(WARNING)&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#nlds_processors.logger.LoggingConsumer.get_logging_func" title="Permalink to this definition"></a></dt>
<dd><p>Selects the appropriate logging function, given a logging level, from a 
Logger object or Logger-like object. The global logger is used by 
default (logging.getLogger(__name__)) but anything which has the 
standard logging operations (debug, info, warning etc. ) can be used 
i.e. the logging package</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_level</strong> (<em>str</em>) – Logging level requested</p></li>
<li><p><strong>logger_like</strong> (<em>Logger</em>) – Logger object to get function from</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The logging function to use</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="nlds-server.html" class="btn btn-neutral float-left" title="NLDS API-server" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="alembic-migrations.html" class="btn btn-neutral float-right" title="Database Migrations with Alembic" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Neil Massey &amp; Jack Leland.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>